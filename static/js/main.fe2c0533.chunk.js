(this["webpackJsonpmories-music-share"]=this["webpackJsonpmories-music-share"]||[]).push([[0],{185:function(e,t,n){"use strict";n.r(t);var a,i,r=n(0),c=n.n(r),o=n(18),s=n.n(o),l=n(24),u=n(237),d=n(241),j=n(70),b=n.n(j),g=n(79),p=n(25),O=n(98),h=n(19),m=n(215),x=n(248),f=n(218),y=n(219),v=n(246),S=n(220),w=n(221),C=n(222),N=n(223),q=n(224),I=n(80),k=n.n(I),A=n(97),E=n.n(A),P=n(96),_=n.n(P),F=n(41),G=Object(h.gql)(a||(a=Object(F.a)(["\n  mutation addOrRemoveFromQueue($input: SongInput!) {\n    addOrRemoveFromQueue(input: $input) @client\n  }\n"]))),T=Object(h.gql)(i||(i=Object(F.a)(["\n  mutation addSong(\n    $title: String!\n    $artist: String!\n    $thumbnail: String!\n    $duration: Float!\n    $url: String!\n  ) {\n    insert_songs(\n      objects: {\n        title: $title\n        artist: $artist\n        thumbnail: $thumbnail\n        duration: $duration\n        url: $url\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]))),Q=n(6),$=Object(m.a)((function(e){return{container:{display:"flex",alignItems:"center"},urlInput:{margin:e.spacing(1)},addSongButton:{margin:e.spacing(1)},dialog:{textAlign:"center"},thumbnail:{width:"90%"}}})),B={duration:0,title:"",artist:"",thumbnail:""};var R=function(){var e=$(),t=Object(h.useMutation)(T),n=Object(l.a)(t,2),a=n[0],i=n[1].error,r=c.a.useState(""),o=Object(l.a)(r,2),s=o[0],u=o[1],d=c.a.useState(!1),j=Object(l.a)(d,2),m=j[0],I=j[1],A=c.a.useState(!1),P=Object(l.a)(A,2),F=P[0],G=P[1],R=c.a.useState(B),M=Object(l.a)(R,2),D=M[0],U=M[1];function L(){return(L=Object(O.a)(b.a.mark((function e(){var t,n,i,r,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=D.url,n=D.thumbnail,i=D.duration,r=D.title,c=D.artist,e.next=4,a({variables:{url:t.length>0?t:null,thumbnail:n.length>0?n:null,duration:i>0?i:null,title:r.length>0?r:null,artist:c.length>0?c:null}});case 4:J(),U(B),u(""),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error adding song",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function W(e){var t=e.target,n=t.name,a=t.value;U((function(e){return Object(p.a)(Object(p.a)({},e),{},Object(g.a)({},n,a))}))}function J(){G(!1)}function Y(){return(Y=Object(O.a)(b.a.mark((function e(t){var n,a,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.player,!(a=n.player.player).getVideoData){e.next=6;break}i=V(a),e.next=10;break;case 6:if(!a.getCurrentSound){e.next=10;break}return e.next=9,z(a);case 9:i=e.sent;case 10:U(Object(p.a)(Object(p.a)({},i),{},{url:s}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return new Promise((function(t){e.getCurrentSound((function(e){e&&t({duration:Number(e.duration/1e3),title:e.title,artist:e.user.username,thumbnail:e.artwork_url.replace("-large","-t500x500")})}))}))}function V(e){var t=e.getDuration(),n=e.getVideoData(),a=n.title,i=n.video_id;return{duration:t,title:a,artist:n.author,thumbnail:"http://img.youtube.com/vi/".concat(i,"/0.jpg")}}function X(e){var t,n;return null===i||void 0===i||null===(t=i.graphQLErrors[0])||void 0===t||null===(n=t.extensions)||void 0===n?void 0:n.path.includes(e)}c.a.useEffect((function(){var e=E.a.canPlay(s)||_.a.canPlay(s);I(e)}),[s]);var K=D.thumbnail,H=D.title,Z=D.artist;return Object(Q.jsxs)("div",{className:e.container,children:[Object(Q.jsxs)(x.a,{className:e.dialog,open:F,onClose:J,children:[Object(Q.jsx)(f.a,{children:"Edit Song"}),Object(Q.jsxs)(y.a,{children:[Object(Q.jsx)("img",{className:e.thumbnail,src:K,alt:"song thumbnail"}),Object(Q.jsx)(v.a,{onChange:W,margin:"dense",name:"title",label:"Title",fullWidth:!0,value:H,error:X("title"),helperText:X("title")&&"Fill out field"}),Object(Q.jsx)(v.a,{onChange:W,margin:"dense",name:"artist",label:"Artist",fullWidth:!0,value:Z,error:X("artist"),helperText:X("artist")&&"Fill out field"}),Object(Q.jsx)(v.a,{onChange:W,margin:"dense",name:"thumbnail",label:"Thumbnail",fullWidth:!0,value:K,error:X("thumbnail"),helperText:X("thumbnail")&&"Fill out field"})]}),Object(Q.jsxs)(S.a,{children:[Object(Q.jsx)(w.a,{onClick:J,color:"secondary",children:"Cancel"}),Object(Q.jsx)(w.a,{variant:"outlined",color:"primary",onClick:function(){return L.apply(this,arguments)},children:"Add Song"})]})]}),Object(Q.jsx)(v.a,{onChange:function(e){return u(e.target.value)},value:s,placeholder:"Add Youtube or Soundcloud Url",fullWidth:!0,margin:"normal",type:"url",InputProps:{startAdornment:Object(Q.jsx)(C.a,{position:"start",children:Object(Q.jsx)(N.a,{className:e.urlInput})})}}),Object(Q.jsx)(w.a,{disabled:!m,className:e.addSongButton,onClick:function(){return G(!0)},variant:"contained",color:"primary",endIcon:Object(Q.jsx)(q.a,{}),children:"Add"}),Object(Q.jsx)(k.a,{url:s,hidden:!0,onReady:function(e){return Y.apply(this,arguments)}})]})},M=n(225),D=n(226),U=n(136),L=n(227),W=Object(m.a)((function(e){return{title:{marginLeft:e.spacing(2)}}}));var J,Y=function(){var e=W();return Object(Q.jsx)(M.a,{color:"primary",position:"fixed",children:Object(Q.jsxs)(D.a,{children:[Object(Q.jsx)(L.a,{}),Object(Q.jsx)(U.a,{className:e.title,variant:"h6",component:"h1",children:"Mories Music Share"})]})})},z=n(228),V=n(229),X=n(230),K=n(231),H=n(232),Z=n(233),ee=n(234),te=n(235),ne=n(236),ae=Object(h.gql)(J||(J=Object(F.a)(["\n  subscription getSongs {\n    songs(order_by: { created_at: desc }) {\n      artist\n      duration\n      id\n      thumbnail\n      title\n      url\n    }\n  }\n"])));var ie=Object(m.a)((function(e){return{container:{margin:e.spacing(3)},songInfoContainer:{display:"flex",alignItems:"center"},songInfo:{width:"100%",display:"flex",justifyContent:"space-between"},thumbnail:{objectFit:"cover",width:140,height:140}}}));function re(e){var t=e.song,n=ie(),a=c.a.useContext(ye),i=a.state,r=a.dispatch,o=t.id,s=t.title,u=t.artist,d=t.thumbnail,j=c.a.useState(!1),b=Object(l.a)(j,2),g=b[0],O=b[1],m=Object(h.useMutation)(G,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),x=Object(l.a)(m,1)[0];return c.a.useEffect((function(){var e=i.isPlaying&&o===i.song.id;O(e)}),[o,i.song.id,i.isPlaying]),Object(Q.jsx)(V.a,{className:n.container,children:Object(Q.jsxs)("div",{className:n.songInfoContainer,children:[Object(Q.jsx)(X.a,{image:d,className:n.thumbnail}),Object(Q.jsxs)("div",{className:n.songInfo,children:[Object(Q.jsxs)(K.a,{children:[Object(Q.jsx)(U.a,{gutterBottom:!0,variant:"h5",component:"h2",children:s}),Object(Q.jsx)(U.a,{gutterBottom:!0,variant:"body1",component:"p",color:"textSecondary",children:u})]}),Object(Q.jsxs)(H.a,{children:[Object(Q.jsx)(Z.a,{onClick:function(){r({type:"SET_SONG",payload:{song:t}}),r(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},size:"small",color:"primary",children:g?Object(Q.jsx)(ee.a,{}):Object(Q.jsx)(te.a,{})}),Object(Q.jsx)(Z.a,{onClick:function(){x({variables:{input:Object(p.a)(Object(p.a)({},t),{},{__typename:"Song"})}})},size:"small",color:"secondary",children:Object(Q.jsx)(ne.a,{})})]})]})]})})}var ce,oe,se=function(){var e=Object(h.useSubscription)(ae),t=e.data,n=e.loading,a=e.error;return n?Object(Q.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:50},children:Object(Q.jsx)(z.a,{})}):a?Object(Q.jsx)("div",{children:"Error fetching songs"}):Object(Q.jsx)("div",{children:t.songs.map((function(e){return Object(Q.jsx)(re,{song:e},e.id)}))})},le=n(250),ue=n(239),de=n(240),je=(Object(h.gql)(ce||(ce=Object(F.a)(["\n  query getSongs {\n    songs(order_by: { created_at: desc }) {\n      artist\n      duration\n      id\n      thumbnail\n      title\n      url\n    }\n  }\n"]))),Object(h.gql)(oe||(oe=Object(F.a)(["\n  query getQueuedSongs {\n    queue @client {\n      id\n      duration\n      title\n      artist\n      thumbnail\n      url\n    }\n  }\n"])))),be=n(249),ge=n(238);var pe=Object(m.a)({avatar:{width:44,height:44},text:{textOverflow:"ellipsis",overflow:"hidden"},container:{display:"grid",gridAutoFlow:"column",gridTemplateColumns:"50px auto 50px",gridGap:12,alignItems:"center",marginTop:10},songInfoContainer:{overflow:"hidden",whiteSpace:"nowrap"}});function Oe(e){var t=e.song,n=pe(),a=Object(h.useMutation)(G,{onCompleted:function(e){localStorage.setItem("queue",JSON.stringify(e.addOrRemoveFromQueue))}}),i=Object(l.a)(a,1)[0],r=t.thumbnail,c=t.artist,o=t.title;return Object(Q.jsxs)("div",{className:n.container,children:[Object(Q.jsx)(be.a,{src:r,alt:"Song Thumbnail",className:n.avatar}),Object(Q.jsxs)("div",{className:n.songInfoContainer,children:[Object(Q.jsx)(U.a,{variant:"subtitle2",className:n.text,children:o}),Object(Q.jsx)(U.a,{color:"textSecondary",variant:"body2",className:n.text,children:c})]}),Object(Q.jsx)(Z.a,{onClick:function(){i({variables:{input:Object(p.a)(Object(p.a)({},t),{},{__typename:"Song"})}})},children:Object(Q.jsx)(ge.a,{color:"error"})})]})}var he=function(e){var t=e.queue;return console.log({queue:t}),Object(u.a)((function(e){return e.breakpoints.up("md")}))&&Object(Q.jsxs)("div",{style:{margin:"10px 0"},children:[Object(Q.jsxs)(U.a,{color:"textSecondary",variant:"button",children:["QUEUE (",t.length,")"]}),t.map((function(e,t){return Object(Q.jsx)(Oe,{song:e},t)}))]})},me=Object(m.a)((function(e){return{container:{display:"flex",justifyContent:"space-between"},details:{display:"flex",flexDirection:"column",padding:"0px 15px"},content:{flex:"1 0 auto"},thumbnail:{width:150},controls:{display:"flex",alignItems:"center",paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},playIcon:{height:38,width:38}}}));var xe=function(){var e,t=Object(h.useQuery)(je).data,n=c.a.useRef(),a=c.a.useContext(ye),i=a.state,r=a.dispatch,o=c.a.useState(0),s=Object(l.a)(o,2),u=s[0],d=s[1],j=c.a.useState(0),b=Object(l.a)(j,2),g=b[0],p=b[1],O=c.a.useState(!1),m=Object(l.a)(O,2),x=m[0],f=m[1],y=c.a.useState(0),v=Object(l.a)(y,2),S=v[0],w=v[1],C=me();return c.a.useEffect((function(){var e=t.queue.findIndex((function(e){return e.id===i.song.id}));w(e)}),[i.song.id,t.queue]),c.a.useEffect((function(){var e=t.queue[S+1];u>=.99&&e&&(d(0),r({type:"SET_SONG",payload:{song:e}}))}),[t.queue,u,S,r]),Object(Q.jsxs)(Q.Fragment,{children:[Object(Q.jsxs)(V.a,{variant:"outlined",className:C.container,children:[Object(Q.jsxs)("div",{className:C.details,children:[Object(Q.jsxs)(K.a,{className:C.content,children:[Object(Q.jsx)(U.a,{variant:"h5",component:"h3",children:i.song.title}),Object(Q.jsx)(U.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:i.song.artist})]}),Object(Q.jsxs)("div",{className:C.controls,children:[Object(Q.jsx)(Z.a,{onClick:function(){var e=t.queue[S-1];e&&r({type:"SET_SONG",payload:{song:e}})},children:Object(Q.jsx)(ue.a,{})}),Object(Q.jsx)(Z.a,{onClick:function(){r(i.isPlaying?{type:"PAUSE_SONG"}:{type:"PLAY_SONG"})},children:i.isPlaying?Object(Q.jsx)(ee.a,{className:C.playIcon}):Object(Q.jsx)(te.a,{className:C.playIcon})}),Object(Q.jsx)(Z.a,{onClick:function(){var e=t.queue[S+1];e&&r({type:"SET_SONG",payload:{song:e}})},children:Object(Q.jsx)(de.a,{})}),Object(Q.jsx)(U.a,{variant:"subtitle1",component:"p",color:"textSecondary",children:(e=g,new Date(1e3*e).toISOString().substr(11,8))})]}),Object(Q.jsx)(le.a,{onMouseDown:function(){f(!0)},onMouseUp:function(){f(!1),n.current.seekTo(u)},onChange:function(e,t){d(t)},value:u,type:"range",min:0,max:1,step:.01})]}),Object(Q.jsx)(k.a,{ref:n,onProgress:function(e){var t=e.played,n=e.playedSeconds;x||(d(t),p(n))},url:i.song.url,playing:i.isPlaying,hidden:!0}),Object(Q.jsx)(X.a,{className:C.thumbnail,image:i.song.thumbnail})]}),Object(Q.jsx)(he,{queue:t.queue})]})};var fe=function(e,t){switch(t.type){case"PLAY_SONG":return Object(p.a)(Object(p.a)({},e),{},{isPlaying:!0});case"PAUSE_SONG":return Object(p.a)(Object(p.a)({},e),{},{isPlaying:!1});case"SET_SONG":return Object(p.a)(Object(p.a)({},e),{},{song:t.payload.song});default:return e}},ye=c.a.createContext({song:{id:"1434c455-1f8e-460e-b31a-9d7759e69212",title:"Shine On",artist:"Pink Floyd",duration:"1322",thumbnail:"https://i.ytimg.com/vi/cWGE9Gi0bB0/hqdefault.jpg?sqp=-oaymwEcCOADEI4CSFXyq4qpAw4IARUAAIhCGAFwAcABBg==&rs=AOn4CLBrrXOrpAUt5wbhlkgrhGTvuKSwdQ",url:"https://www.youtube.com/watch?v=cWGE9Gi0bB0"},isPlaying:!1});var ve,Se=function(){var e=c.a.useContext(ye),t=c.a.useReducer(fe,e),n=Object(l.a)(t,2),a=n[0],i=n[1],r=Object(u.a)((function(e){return e.breakpoints.up("md")}));return Object(Q.jsxs)(ye.Provider,{value:{state:a,dispatch:i},children:[Object(Q.jsx)(Y,{}),Object(Q.jsxs)(d.a,{container:!0,spacing:3,children:[Object(Q.jsxs)(d.a,{style:{paddingTop:"80px"},item:!0,xs:12,md:7,children:[Object(Q.jsx)(R,{}),Object(Q.jsx)(se,{})]}),Object(Q.jsx)(d.a,{style:r?{position:"fixed",width:"100%",right:0,top:"70px"}:{position:"fixed",width:"100%",left:0,bottom:0},item:!0,xs:12,md:5,children:Object(Q.jsx)(xe,{})})]})]})},we=n(244),Ce=n(245),Ne=n(131),qe=n(242),Ie=n(243),ke=Object(Ne.a)({palette:{type:"dark",primary:qe.a,secondary:Ie.a}}),Ae=n(132),Ee=n(133),Pe=new h.ApolloClient({link:new Ee.a({uri:"wss://mories-music-share.herokuapp.com/v1/graphql",options:{reconnect:!0}}),cache:new h.InMemoryCache,typeDefs:Object(h.gql)(ve||(ve=Object(F.a)(["\n    type Song {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n\n    input SongInput {\n      id: uuid!\n      title: String!\n      artist: String!\n      thumbnail: String!\n      duration: Float!\n      url: String!\n    }\n\n    type Query {\n      queue: [Song]!\n    }\n\n    type Mutation {\n      addOrRemoveFromQueue(input: SongInput!): [Song]!\n    }\n  "]))),resolvers:{Mutation:{addOrRemoveFromQueue:function(e,t,n){var a=t.input,i=n.cache,r=i.readQuery({query:je});if(r){var c=r.queue,o=c.some((function(e){return e.id===a.id}))?c.filter((function(e){return e.id!==a.id})):[].concat(Object(Ae.a)(c),[a]);return i.writeQuery({query:je,data:{queue:o}}),o}return[]}}}}),_e={queue:Boolean(localStorage.getItem("queue"))?JSON.parse(localStorage.getItem("queue")):[]};Pe.writeQuery({query:je,data:_e});var Fe=Pe;s.a.render(Object(Q.jsx)(h.ApolloProvider,{client:Fe,children:Object(Q.jsxs)(we.a,{theme:ke,children:[Object(Q.jsx)(Ce.a,{}),Object(Q.jsx)(Se,{})]})}),document.getElementById("root"))}},[[185,1,2]]]);
//# sourceMappingURL=main.fe2c0533.chunk.js.map